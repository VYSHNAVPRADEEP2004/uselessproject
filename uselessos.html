<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TurmoilOS - The Most Useless Operating System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #6b73ff 0%, #9b59b6 100%);
            height: 100vh;
        }

        .desktop {
            height: 100vh;
            position: relative;
            background: linear-gradient(135deg, #6b73ff 0%, #9b59b6 100%);
        }

        /* Main Big Clown at center of desktop */
        .desktop-clown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 200px;
            animation: clown-bounce 2s ease-in-out infinite;
            text-shadow: 5px 5px 15px rgba(0, 0, 0, 0.5);
            z-index: 1;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .desktop-clown:hover {
            transform: translate(-50%, -50%) scale(1.1);
            animation-duration: 0.5s;
        }

        /* Secondary Clowns */
        .desktop-clown-small {
            position: absolute;
            font-size: 120px;
            animation: clown-wiggle 3s ease-in-out infinite;
            text-shadow: 3px 3px 10px rgba(0, 0, 0, 0.5);
            z-index: 1;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .desktop-clown-small:hover {
            transform: scale(1.2) rotate(10deg);
            animation-duration: 1s;
        }

        .desktop-clown-small.clown2 {
            top: 25%;
            right: 20%;
            animation-delay: -0.5s;
        }

        .desktop-clown-small.clown3 {
            bottom: 25%;
            left: 15%;
            animation-delay: -1s;
        }

        @keyframes clown-bounce {

            0%,
            100% {
                transform: translate(-50%, -50%) scale(1);
            }

            50% {
                transform: translate(-50%, -50%) scale(1.05) rotate(2deg);
            }
        }

        @keyframes clown-wiggle {

            0%,
            100% {
                transform: scale(1) rotate(0deg);
            }

            25% {
                transform: scale(1.08) rotate(-3deg);
            }

            50% {
                transform: scale(0.95) rotate(0deg);
            }

            75% {
                transform: scale(1.05) rotate(3deg);
            }
        }

        .menu-bar {
            background: #f0f0f0;
            height: 30px;
            display: flex;
            align-items: center;
            padding: 0 10px;
            border-bottom: 1px solid #ccc;
            font-size: 14px;
        }

        .menu-item {
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
            transition: background 0.2s;
        }

        .menu-item:hover {
            background: #e0e0e0;
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80px;
            padding: 10px;
            cursor: pointer;
            border-radius: 5px;
            transition: background 0.2s;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
            position: absolute;
            z-index: 2;
        }

        .desktop-icon:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .icon {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .icon-name {
            font-size: 12px;
            text-align: center;
            line-height: 1.2;
        }

        .taskbar {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 40px;
            background: linear-gradient(to bottom, #4a4a4a, #2d2d2d);
            border-top: 1px solid #666;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            z-index: 100;
        }

        .start-button {
            background: linear-gradient(to bottom, #5a5a5a, #3a3a3a);
            border: 1px solid #777;
            color: white;
            padding: 5px 15px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
        }

        .start-button:hover {
            background: linear-gradient(to bottom, #6a6a6a, #4a4a4a);
        }

        .system-info {
            color: white;
            font-size: 12px;
            display: flex;
            gap: 15px;
        }

        .window {
            position: absolute;
            background: #f0f0f0;
            border: 2px solid #ccc;
            border-radius: 5px;
            min-width: 400px;
            min-height: 300px;
            display: none;
            z-index: 1000;
        }

        .window-header {
            background: linear-gradient(to bottom, #4a90e2, #357abd);
            color: white;
            padding: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }

        .window-title {
            font-weight: bold;
        }

        .window-controls {
            display: flex;
            gap: 5px;
        }

        .window-control {
            width: 20px;
            height: 20px;
            background: #ff5f56;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            color: white;
            font-size: 12px;
        }

        .window-control.minimize {
            background: #ffbd2e;
        }

        .window-control.maximize {
            background: #27ca3f;
        }

        .window-content {
            padding: 20px;
            height: calc(100% - 70px);
            overflow: hidden;
        }

        .calculator {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            max-width: 300px;
        }

        .calc-display {
            grid-column: span 4;
            padding: 10px;
            text-align: right;
            background: #000;
            color: #0f0;
            font-family: monospace;
            font-size: 18px;
            border: 1px solid #ccc;
        }

        .calc-button {
            padding: 15px;
            background: #e0e0e0;
            border: 1px solid #ccc;
            cursor: pointer;
            font-size: 16px;
        }

        .calc-button:hover {
            background: #d0d0d0;
        }

        .notepad-area {
            width: 100%;
            height: 200px;
            font-family: monospace;
            padding: 10px;
            border: 1px solid #ccc;
            user-select: text;
            resize: none;
        }

        .notepad-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .notepad-input {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-family: inherit;
        }

        .terminal {
            background: #000;
            color: #0f0;
            font-family: monospace;
            padding: 20px;
            height: 100%;
            overflow-y: auto;
        }

        .terminal-input {
            background: transparent;
            border: none;
            color: #0f0;
            outline: none;
            font-family: monospace;
            width: 80%;
        }

        .start-menu {
            position: absolute;
            bottom: 40px;
            left: 10px;
            background: linear-gradient(to bottom, #f0f0f0, #d0d0d0);
            border: 2px solid #ccc;
            border-radius: 5px;
            width: 250px;
            display: none;
            z-index: 2000;
        }

        .start-menu-item {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .start-menu-item:hover {
            background: #e0e0e0;
        }

        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 2px solid #ccc;
            border-radius: 5px;
            padding: 20px;
            z-index: 3000;
            display: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            max-width: 400px;
        }

        .bsod {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0000ff;
            color: white;
            display: none;
            z-index: 9999;
            padding: 50px;
            font-family: monospace;
            animation: bsod-flicker 0.5s infinite;
        }

        @keyframes bsod-flicker {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.8;
            }
        }

        .browser-content {
            text-align: center;
            padding: 50px;
        }

        .donkey-image {
            font-size: 120px;
            margin: 20px 0;
        }

        .settings-content {
            text-align: center;
            padding: 30px;
        }

        .settings-option {
            background: linear-gradient(to bottom, #e8e8e8, #d0d0d0);
            border: 2px solid #999;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.2s;
            display: inline-block;
            min-width: 120px;
        }

        .settings-option:hover {
            background: linear-gradient(to bottom, #f0f0f0, #e0e0e0);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .settings-option:active {
            transform: translateY(0px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* FIXED: Added center alignment for Our Goals section */
        .goals-section {
            text-align: center;
            margin: 20px 0;
        }

        .goals-list {
            display: inline-block;
            text-align: left;
            margin: 0 auto;
        }

        .file-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 2px solid #ccc;
            border-radius: 5px;
            padding: 20px;
            z-index: 4000;
            display: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            min-width: 300px;
        }

        .file-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            margin: 10px 0;
            padding: 5px;
        }

        .file-item {
            padding: 5px;
            cursor: pointer;
            border-radius: 3px;
        }

        .file-item:hover {
            background: #e0e0e0;
        }

        .file-item.selected {
            background: #0078d4;
            color: white;
        }
    </style>
</head>

<body>
    <div class="desktop">
        <!-- Main Big Clown at Center -->
        <div class="desktop-clown" onclick="clownClicked('main')">ğŸ¤¡</div>

        <!-- Secondary Clowns -->
        <div class="desktop-clown-small clown2" onclick="clownClicked('second')">ğŸ¤¡</div>
        <div class="desktop-clown-small clown3" onclick="clownClicked('third')">ğŸ¤¡</div>

        <!-- Desktop Icons -->
        <div class="desktop-icon" style="top: 60px; left: 50px;" onclick="openSettings()">
            <div class="icon">âš™ï¸</div>
            <div class="icon-name">Useless Settings</div>
        </div>

        <div class="desktop-icon" style="top: 160px; left: 50px;" onclick="openCalculator()">
            <div class="icon">ğŸ§®</div>
            <div class="icon-name">Useless Calculator</div>
        </div>

        <div class="desktop-icon" style="top: 280px; left: 50px;" onclick="openNotepad()">
            <div class="icon">ğŸ“</div>
            <div class="icon-name">Pointless Notepad</div>
        </div>

        <div class="desktop-icon" style="top: 400px; left: 50px;" onclick="openBrowser()">
            <div class="icon">ğŸŒ</div>
            <div class="icon-name">Useless Browser</div>
        </div>

        <div class="desktop-icon" style="top: 520px; left: 50px;" onclick="openTerminal()">
            <div class="icon">ğŸ’»</div>
            <div class="icon-name">Useless Terminal</div>
        </div>

        <div class="desktop-icon" style="top: 640px; left: 50px;" onclick="showRecycleBinMessage()">
            <div class="icon">ğŸ—‘ï¸</div>
            <div class="icon-name">Recycle Bin</div>
        </div>

        <!-- Taskbar -->
        <div class="taskbar">
            <div class="start-button" onclick="toggleStartMenu()">ğŸŸ© Start</div>
            <div class="system-info">
                <span id="time">25:99 ZM</span>
                <span id="battery">ğŸ”‹ -5%</span>
                <span>ğŸ“¶</span>
            </div>
        </div>

        <!-- Start Menu -->
        <div class="start-menu" id="startMenu">
            <div class="start-menu-item" onclick="openCalculator()">
                <span>ğŸ§®</span> Useless Calculator
            </div>
            <div class="start-menu-item" onclick="openNotepad()">
                <span>ğŸ“</span> Pointless Notepad
            </div>
            <div class="start-menu-item" onclick="openBrowser()">
                <span>ğŸŒ</span> Useless Browser
            </div>
            <div class="start-menu-item" onclick="openTerminal()">
                <span>ğŸ’»</span> Useless Terminal
            </div>
            <div class="start-menu-item" onclick="showRecycleBinMessage()">
                <span>ğŸ—‘ï¸</span> Recycle Bin
            </div>
            <div class="start-menu-item" onclick="openSettings()">
                <span>âš™ï¸</span> Useless Settings
            </div>
        </div>
    </div>

    <!-- Settings Window -->
    <div class="window" id="settingsWindow" style="top: 80px; left: 180px; width: 600px; height: 500px;">
        <div class="window-header">
            <div class="window-title">Useless Settings</div>
            <div class="window-controls">
                <button class="window-control minimize" onclick="minimizeWindow('settingsWindow')">-</button>
                <button class="window-control maximize" onclick="maximizeWindow('settingsWindow')">â–¡</button>
                <button class="window-control" onclick="closeWindow('settingsWindow')">Ã—</button>
            </div>
        </div>
        <div class="menu-bar">
            <div class="menu-item" onclick="showFileMessage()">File</div>
            <div class="menu-item" onclick="showEditMessage()">Edit</div>
            <div class="menu-item" onclick="showViewMessage()">View</div>
            <div class="menu-item" onclick="showWindowMessage()">Window</div>
            <div class="menu-item" onclick="showHelpMessage()">Help</div>
        </div>
        <div class="window-content settings-content">
            <h2>ğŸ”§ Welcome to Useless Settings! ğŸ”§</h2>
            <br>
            <p style="margin-bottom: 20px; color: #666;">
                Configure your stupidity levels and adjust your idiocy preferences!
            </p>

            <div class="settings-option"
                onclick="showPopup('ğŸ¨ Theme changed to: More Useless!<br>Your interface is now 50% more annoying!')">
                ğŸ¨ Change Theme
            </div>

            <div class="settings-option"
                onclick="showPopup('ğŸ”Š Sound settings updated!<br>All sounds now play backwards because you\'re backwards!')">
                ğŸ”Š Audio Settings
            </div>

            <div class="settings-option"
                onclick="showPopup('ğŸŒ Network settings corrupted!<br>Your Wi-Fi password is now: PASSWORD123')">
                ğŸŒ Network
            </div>

            <div class="settings-option"
                onclick="showPopup('ğŸ‘¤ User account downgraded!<br>You are now: Supreme Idiot (Administrator)')">
                ğŸ‘¤ User Accounts
            </div>

            <div class="settings-option"
                onclick="showPopup('ğŸ›¡ï¸ Security disabled!<br>Your computer is now protected by thoughts and prayers!')">
                ğŸ›¡ï¸ Security
            </div>

            <div class="settings-option"
                onclick="showPopup('âš¡ Performance optimized!<br>Your computer now runs at the speed of your brain: 0.1 Hz')">
                âš¡ Performance
            </div>

            <!-- FIXED: Updated Our Goals section with proper centering -->
            <div class="goals-section">
                <h3 style="color: #666; margin: 20px 0;">ğŸ¯ Our Goals ğŸ¯</h3>
                <div class="goals-list">
                    <ul style="color: #666; line-height: 1.6;">
                        <li>Provide a safe space for supreme idiots to feel at home</li>
                        <li>Showcase creatures that share your intelligence level</li>
                        <li>Prove that even donkeys and clowns can be more productive than you</li>
                        <li>Offer educational content at your comprehension level</li>
                    </ul>
                </div>
            </div>

            <br>
            <p style="color: #999; font-style: italic; margin-top: 15px;">
                Remember: No matter what you change here, you'll still be an idiot! ğŸ˜‚
            </p>
        </div>
    </div>

    <!-- Calculator Window -->
    <div class="window" id="calculatorWindow" style="top: 100px; left: 200px;">
        <div class="window-header">
            <div class="window-title">Useless Calculator</div>
            <div class="window-controls">
                <button class="window-control minimize" onclick="minimizeWindow('calculatorWindow')">-</button>
                <button class="window-control maximize" onclick="maximizeWindow('calculatorWindow')">â–¡</button>
                <button class="window-control" onclick="closeWindow('calculatorWindow')">Ã—</button>
            </div>
        </div>
        <div class="window-content">
            <div class="calculator">
                <input type="text" class="calc-display" id="calcDisplay" readonly>
                <button class="calc-button" onclick="clearCalc()">C</button>
                <button class="calc-button" onclick="appendToCalc('/')">/</button>
                <button class="calc-button" onclick="appendToCalc('*')">*</button>
                <button class="calc-button" onclick="deleteLast()">â†</button>
                <button class="calc-button" onclick="appendToCalc('7')">7</button>
                <button class="calc-button" onclick="appendToCalc('8')">8</button>
                <button class="calc-button" onclick="appendToCalc('9')">9</button>
                <button class="calc-button" onclick="appendToCalc('-')">-</button>
                <button class="calc-button" onclick="appendToCalc('4')">4</button>
                <button class="calc-button" onclick="appendToCalc('5')">5</button>
                <button class="calc-button" onclick="appendToCalc('6')">6</button>
                <button class="calc-button" onclick="appendToCalc('+')">+</button>
                <button class="calc-button" onclick="appendToCalc('1')">1</button>
                <button class="calc-button" onclick="appendToCalc('2')">2</button>
                <button class="calc-button" onclick="appendToCalc('3')">3</button>
                <button class="calc-button" onclick="calculateReverse()" rowspan="2">=</button>
                <button class="calc-button" onclick="appendToCalc('0')" colspan="2">0</button>
                <button class="calc-button" onclick="appendToCalc('.')">.</button>
            </div>
        </div>
    </div>

    <!-- Notepad Window -->
    <div class="window" id="notepadWindow" style="top: 120px; left: 220px; width: 500px;">
        <div class="window-header">
            <div class="window-title">Pointless Notepad - <span id="currentFileName">Untitled</span></div>
            <div class="window-controls">
                <button class="window-control minimize" onclick="minimizeWindow('notepadWindow')">-</button>
                <button class="window-control maximize" onclick="maximizeWindow('notepadWindow')">â–¡</button>
                <button class="window-control" onclick="closeWindow('notepadWindow')">Ã—</button>
            </div>
        </div>
        <div class="window-content">
            <div class="notepad-controls">
                <button onclick="newNotepadFile()">New</button>
                <button onclick="showSaveDialog()">Save</button>
                <button onclick="showOpenDialog()">Open</button>
                <span style="margin-left: 20px;">Current File: <span id="statusFileName">Untitled</span></span>
            </div>
            <textarea class="notepad-area" id="notepadText" placeholder="Type your useless thoughts here..."></textarea>
        </div>
    </div>

    <!-- Browser Window -->
    <div class="window" id="browserWindow" style="top: 140px; left: 240px; width: 600px; height: 400px;">
        <div class="window-header">
            <div class="window-title">Useless Browser</div>
            <div class="window-controls">
                <button class="window-control minimize" onclick="minimizeWindow('browserWindow')">-</button>
                <button class="window-control maximize" onclick="maximizeWindow('browserWindow')">â–¡</button>
                <button class="window-control" onclick="closeWindow('browserWindow')">Ã—</button>
            </div>
        </div>
        <div class="window-content browser-content">
            <h1>Welcome to the Internet of Idiots!</h1>
            <div class="donkey-image">ğŸ´</div>
            <h2>Congratulations! You found the donkey!</h2>
            <p>This is the only website on this useless browser.</p>
        </div>
    </div>

    <!-- Terminal Window -->
    <div class="window" id="terminalWindow" style="top: 160px; left: 260px; width: 600px; height: 400px;">
        <div class="window-header">
            <div class="window-title">Useless Terminal</div>
            <div class="window-controls">
                <button class="window-control minimize" onclick="minimizeWindow('terminalWindow')">-</button>
                <button class="window-control maximize" onclick="maximizeWindow('terminalWindow')">â–¡</button>
                <button class="window-control" onclick="closeWindow('terminalWindow')">Ã—</button>
            </div>
        </div>
        <div class="window-content terminal" id="terminalContent">
            <div>TurmoilOS Terminal v1.0 - The Most Annoying Terminal Ever</div>
            <div>Type 'help' for commands (not that they'll help you much)</div>
            <br>
            <div id="terminalOutput"></div>
            <div>
                <span>idiot@turmoil:~$ </span>
                <input type="text" class="terminal-input" id="terminalInput" onkeypress="handleTerminalInput(event)">
            </div>
        </div>
    </div>

    <!-- Save File Dialog -->
    <div class="file-dialog" id="saveDialog">
        <h3>ğŸ’¾ Save File (For A Supreme Idiot)</h3>
        <div>
            <label>Filename:</label>
            <input type="text" id="saveFileName" class="notepad-input" placeholder="Enter filename..."
                style="width: 200px;">
        </div>
        <div style="margin-top: 15px;">
            <button onclick="saveFile()">Save</button>
            <button onclick="closeSaveDialog()">Cancel</button>
        </div>
    </div>

    <!-- Open File Dialog -->
    <div class="file-dialog" id="openDialog">
        <h3>ğŸ“‚ Open File (For A Moron)</h3>
        <div class="file-list" id="fileList">
            <!-- Files will be populated here -->
        </div>
        <div>
            <label>Selected File:</label>
            <input type="text" id="selectedFileName" class="notepad-input" readonly style="width: 200px;">
        </div>
        <div style="margin-top: 15px;">
            <button onclick="openSelectedFile()">Open</button>
            <button onclick="closeOpenDialog()">Cancel</button>
        </div>
    </div>

    <!-- Popup for messages -->
    <div class="popup" id="messagePopup">
        <div id="popupContent"></div>
        <button onclick="closePopup()" style="margin-top: 10px;">OK (if you say so)</button>
    </div>

    <!-- BSOD Screen -->
    <div class="bsod" id="bsodScreen">
        <h1>ğŸ’€ SYSTEM CRASHED ğŸ’€</h1>
        <br>
        <h2>VIRUS DETECTED: STUPIDITY.EXE</h2>
        <br>
        <p>A critical error has occurred. Your brain.dll has stopped working.</p>
        <br>
        <p>Error Code: 0x8007DUMB</p>
        <p>Error Message: User is too dumb to operate this system</p>
        <br>
        <p>Technical Information:</p>
        <p>*** STOP: 0x000000IDIOT (0xDEADBEEF, 0xCAFEBABE, 0x12345678, 0x87654321)</p>
        <br>
        <p>Beginning dump of physical memory...</p>
        <p>Physical memory dump complete.</p>
        <br>
        <p>Contact your system administrator (if they can tolerate you)</p>
        <br>
        <div style="position: absolute; bottom: 50px; left: 50px;">
            <button onclick="hideBSOD()"
                style="background: red; color: white; padding: 10px; border: none; cursor: pointer;">
                Restart (and try not to be so dumb next time)
            </button>
        </div>
    </div>

    <script>
        // System variables
        let calcCurrentInput = '';
        let calcOperator = '';
        let calcPreviousInput = '';
        let terminalHistory = [];
        let savedFiles = {}; // Store files in memory
        let currentFileName = 'Untitled';
        let isFileSaved = true; // Track if current file has been saved
        let lastSavedContent = ''; // Track last saved content
        let clownClickCount = 0;
        let secondClownClicks = 0;
        let thirdClownClicks = 0;

        // Enhanced Clown click handler with individual tracking
        function clownClicked(clownType) {
            if (clownType === 'main') {
                clownClickCount++;
                handleMainClownClick();
            } else if (clownType === 'second') {
                secondClownClicks++;
                handleSecondClownClick();
            } else if (clownType === 'third') {
                thirdClownClicks++;
                handleThirdClownClick();
            }

            // Check for ultimate clown chaos (all clowns clicked multiple times)
            if (clownClickCount >= 3 && secondClownClicks >= 3 && thirdClownClicks >= 3) {
                setTimeout(() => {
                    showPopup("ğŸªğŸ¤¡ ULTIMATE CLOWN APOCALYPSE! ğŸ¤¡ğŸª<br><br>ALL THREE CLOWNS HAVE BEEN AWAKENED!<br>THE CIRCUS HAS TAKEN OVER THE SYSTEM!<br><br>ğŸª CHAOS LEVEL: MAXIMUM ğŸª<br><br>There is no escape from the clown dimension now! ğŸŒªï¸ğŸ¤¡");
                    setTimeout(() => {
                        // Super chaos mode
                        document.body.style.filter = 'hue-rotate(360deg) saturate(3) contrast(2)';
                        setTimeout(showBSOD, 2000);
                    }, 3000);
                }, 1000);
            }
        }

        function handleMainClownClick() {
            const clownMessages = [
                "ğŸ¤¡ HONK HONK! ğŸ¤¡<br><br>Welcome to the MAIN circus, you magnificent fool!<br>You clicked the HEAD CLOWN! That makes you... the ring leader! ğŸª",
                "ğŸ¤¡ MAIN CLOWN ALERT! ğŸ¤¡<br><br>The HEAD CLOWN is watching you!<br>Every click makes you more... clown-like! ğŸ­<br><br>Main Clown clicks: " + clownClickCount,
                "ğŸ¤¡ HEAD CLOWN ACTIVATED! ğŸ¤¡<br><br>You've activated SUPREME CLOWN MODE!<br>The main clown's transformation is 66% complete! ğŸªğŸ­<br><br>The circus is spreading!",
                "ğŸ¤¡ RING LEADER ACKNOWLEDGED! ğŸ¤¡<br><br>The HEAD CLOWN crowns you CHIEF OF CLOWNS!<br>You are now the supreme leader of the Idiot Circus! ğŸ‘‘ğŸ¤¡<br><br>Your reign of silliness begins!",
                "ğŸ¤¡ ULTIMATE HEAD CLOWN! ğŸ¤¡<br><br>You clicked the main clown " + clownClickCount + " times!<br>You are now the EMPEROR OF ALL CLOWNS! ğŸ‘‘ğŸ¤¡<br><br>All other clowns bow to your stupidity!"
            ];

            let messageIndex = Math.min(clownClickCount - 1, clownMessages.length - 1);
            if (clownClickCount > 5) {
                messageIndex = 4;
            }

            showPopup(clownMessages[messageIndex]);

            if (clownClickCount >= 3) {
                document.body.style.filter = 'hue-rotate(' + (clownClickCount * 90) + 'deg)';
                setTimeout(() => {
                    document.body.style.filter = 'none';
                }, 2000);
            }
        }

        function handleSecondClownClick() {
            const secondClownMessages = [
                "ğŸ­ SECOND CLOWN ACTIVATED! ğŸ­<br><br>The RIGHT-HAND CLOWN has noticed you!<br>This clown specializes in advanced stupidity! ğŸª",
                "ğŸ­ ASSISTANT CLOWN ENGAGED! ğŸ­<br><br>The second clown is building up power!<br>Assistant clown energy: " + (secondClownClicks * 25) + "%<br><br>Things are getting more chaotic! ğŸŒªï¸",
                "ğŸ­ DEPUTY CLOWN UNLEASHED! ğŸ­<br><br>The second clown has reached FULL POWER!<br>Your idiocy levels are now CRITICALLY HIGH! âš ï¸ğŸ¤¡<br><br>The assistant has become the master!",
                "ğŸ­ SECOND-IN-COMMAND! ğŸ­<br><br>The assistant clown declares you VICE PRESIDENT OF STUPIDITY!<br>You now hold the second-highest rank in the Clown Hierarchy! ğŸ†ğŸ­",
                "ğŸ­ ETERNAL SECOND CLOWN! ğŸ­<br><br>" + secondClownClicks + " clicks on the assistant clown!<br>You are now the DEPUTY EMPEROR OF CLOWNS! ğŸªğŸ‘‘<br><br>Your secondary silliness is unmatched!"
            ];

            let messageIndex = Math.min(secondClownClicks - 1, secondClownMessages.length - 1);
            if (secondClownClicks > 5) {
                messageIndex = 4;
            }

            showPopup(secondClownMessages[messageIndex]);

            if (secondClownClicks >= 2) {
                const clown = document.querySelector('.clown2');
                clown.style.filter = 'hue-rotate(' + (secondClownClicks * 120) + 'deg) saturate(2)';
                setTimeout(() => {
                    clown.style.filter = 'none';
                }, 3000);
            }
        }

        function handleThirdClownClick() {
            const thirdClownMessages = [
                "ğŸª THIRD CLOWN AWAKENED! ğŸª<br><br>The WILDCARD CLOWN has joined the chaos!<br>This clown is completely unpredictable! ğŸŒªï¸ğŸ¤¡",
                "ğŸª CHAOS CLOWN ACTIVATED! ğŸª<br><br>The third clown thrives on pure chaos!<br>Chaos meter: " + (thirdClownClicks * 33) + "%<br><br>Reality is becoming unstable! ğŸŒ€",
                "ğŸª ANARCHY CLOWN RELEASED! ğŸª<br><br>The third clown has reached MAXIMUM CHAOS!<br>All rules of logic have been suspended! ğŸš«ğŸ§ <br><br>Welcome to the realm of pure nonsense!",
                "ğŸª MINISTER OF MAYHEM! ğŸª<br><br>The chaos clown appoints you SECRETARY OF STUPIDITY!<br>You now control the Department of Absolute Nonsense! ğŸ¢ğŸ¤¡",
                "ğŸª ETERNAL CHAOS CLOWN! ğŸª<br><br>" + thirdClownClicks + " clicks of pure chaos!<br>You are now the MINISTER OF MAXIMUM MAYHEM! ğŸªâš¡<br><br>Your chaotic energy knows no bounds!"
            ];

            let messageIndex = Math.min(thirdClownClicks - 1, thirdClownMessages.length - 1);
            if (thirdClownClicks > 5) {
                messageIndex = 4;
            }

            showPopup(thirdClownMessages[messageIndex]);

            if (thirdClownClicks >= 2) {
                const clown = document.querySelector('.clown3');
                clown.style.transform += ` rotate(${thirdClownClicks * 45}deg)`;
                clown.style.filter = 'brightness(1.5) contrast(2) saturate(3)';
                setTimeout(() => {
                    clown.style.filter = 'none';
                    clown.style.transform = clown.style.transform.replace(` rotate(${thirdClownClicks * 45}deg)`, '');
                }, 2000);
            }
        }

        // Absurd time and battery updates
        function updateSystemInfo() {
            const timeElement = document.getElementById('time');
            const batteryElement = document.getElementById('battery');

            const randomHour = Math.floor(Math.random() * 30) + 10;
            const randomMinute = Math.floor(Math.random() * 99);
            const randomSecond = Math.floor(Math.random() * 99);
            timeElement.textContent = `${randomHour}:${randomMinute}:${randomSecond} ${Math.random() > 0.5 ? 'AM' : 'ZM'}`;

            const randomBattery = Math.floor(Math.random() * 200) - 50;
            batteryElement.textContent = `ğŸ”‹ ${randomBattery}%`;
        }

        setInterval(updateSystemInfo, 2000);

        // Menu bar functions
        function showFileMessage() {
            showPopup("ğŸ“ File cannot be created for losers such as you! ğŸ˜‚<br><br>Error Details:<br>â€¢ Loser.exe detected<br>â€¢ Insufficient brain cells<br>â€¢ File system corrupted by stupidity<br><br>Try again never!");
        }

        function showEditMessage() {
            showPopup("âœï¸ Edit your rotten brain you idiot! ğŸ§ ğŸ’€<br><br>Edit Options Available:<br>â€¢ Delete stupidity.dll (FAILED)<br>â€¢ Upgrade intelligence.sys (NOT COMPATIBLE)<br>â€¢ Format brain.exe (ALREADY CORRUPTED)<br><br>No changes can be made to your hopeless mind!");
        }

        function showViewMessage() {
            showPopup("ğŸ‘€ View the donkey! ğŸ´<br><br>ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´<br>ğŸ´ DONKEY! ğŸ´<br>ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´<br><br>Congratulations! You're looking at something smarter than you!");
        }

        function showWindowMessage() {
            showPopup("ğŸªŸ Jump out of the window! ğŸ’¨<br><br>Instructions:<br>1. Locate nearest window<br>2. Open window<br>3. Jump (metaphorically, of course!)<br><br>Warning: Your stupidity might survive the fall! ğŸ˜‚");
        }

        function showHelpMessage() {
            showPopup("ğŸ”¥ Go to hell! ğŸ˜ˆğŸ”¥<br><br>Help Topics:<br>â€¢ How to be less stupid: IMPOSSIBLE<br>â€¢ Troubleshooting your brain: NOT FOUND<br>â€¢ Getting technical support: DENIED<br><br>No help available for hopeless cases like you!");
        }

        // Popup functions
        function showPopup(message) {
            document.getElementById('popupContent').innerHTML = message;
            document.getElementById('messagePopup').style.display = 'block';
        }

        function closePopup() {
            document.getElementById('messagePopup').style.display = 'none';
        }

        // Start menu
        function toggleStartMenu() {
            const menu = document.getElementById('startMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        // Window management
        function openWindow(windowId) {
            const window = document.getElementById(windowId);
            if (window) {
                window.style.display = 'block';
            }
            document.getElementById('startMenu').style.display = 'none';
        }

        function closeWindow(windowId) {
            document.getElementById(windowId).style.display = 'none';
        }

        function minimizeWindow(windowId) {
            document.getElementById(windowId).style.display = 'none';
        }

        function maximizeWindow(windowId) {
            const window = document.getElementById(windowId);
            if (window.style.width === '100vw') {
                window.style.width = '600px';
                window.style.height = '400px';
                window.style.top = '100px';
                window.style.left = '200px';
            } else {
                window.style.width = '100vw';
                window.style.height = 'calc(100vh - 40px)';
                window.style.top = '30px';
                window.style.left = '0';
            }
        }

        // Application launchers
        function openCalculator() {
            openWindow('calculatorWindow');
        }

        function openNotepad() {
            openWindow('notepadWindow');
        }

        function openBrowser() {
            openWindow('browserWindow');
        }

        function openTerminal() {
            openWindow('terminalWindow');
            document.getElementById('terminalInput').focus();
        }

        function openSettings() {
            openWindow('settingsWindow');
        }

        // Calculator functions (reverse logic)
        function appendToCalc(value) {
            document.getElementById('calcDisplay').value += value;
        }

        function clearCalc() {
            document.getElementById('calcDisplay').value = '';
        }

        function deleteLast() {
            const display = document.getElementById('calcDisplay');
            display.value = display.value.slice(0, -1);
        }

        function calculateReverse() {
            const display = document.getElementById('calcDisplay');
            const expression = display.value;

            try {
                let result;
                if (expression.includes('+')) {
                    const parts = expression.split('+');
                    result = parseFloat(parts[0]) - parseFloat(parts[1]);
                    showPopup(`Ha! You tried to add ${parts[0]} + ${parts[1]}, but I gave you ${result} instead! (Subtraction) ğŸ˜‚`);
                } else if (expression.includes('-')) {
                    const parts = expression.split('-');
                    result = parseFloat(parts[0]) + parseFloat(parts[1]);
                    showPopup(`Ha! You tried to subtract ${parts[0]} - ${parts[1]}, but I gave you ${result} instead! (Addition) ğŸ˜‚`);
                } else if (expression.includes('*')) {
                    const parts = expression.split('*');
                    if (parseFloat(parts[1]) !== 0) {
                        result = parseFloat(parts[0]) / parseFloat(parts[1]);
                        showPopup(`Ha! You tried to multiply ${parts[0]} Ã— ${parts[1]}, but I gave you ${result} instead! (Division) ğŸ˜‚`);
                    } else {
                        result = "âˆ (Infinity, like your stupidity!)";
                    }
                } else if (expression.includes('/')) {
                    const parts = expression.split('/');
                    result = parseFloat(parts[0]) * parseFloat(parts[1]);
                    showPopup(`Ha! You tried to divide ${parts[0]} Ã· ${parts[1]}, but I gave you ${result} instead! (Multiplication) ğŸ˜‚`);
                } else {
                    result = expression + " = Still an idiot!";
                }

                display.value = result;
            } catch (error) {
                display.value = 'Error: Brain.exe not found';
                showPopup("Calculator Error: Your mathematical skills are as broken as this calculator! ğŸ¤–ğŸ’¥");
            }
        }

        // Enhanced Notepad functions - Windows Notepad behavior
        function updateFileName(name) {
            currentFileName = name || 'Untitled';
            document.getElementById('currentFileName').textContent = currentFileName;
            document.getElementById('statusFileName').textContent = currentFileName;
        }

        function hasUnsavedChanges() {
            const currentContent = document.getElementById('notepadText').value;
            return currentContent !== lastSavedContent;
        }

        function resetNotepadState() {
            currentFileName = 'Untitled';
            isFileSaved = true;
            lastSavedContent = '';
            document.getElementById('notepadText').value = '';
            updateFileName('Untitled');
        }

        function newNotepadFile() {
            // Check if there are unsaved changes
            if (hasUnsavedChanges()) {
                const userChoice = confirm(`Do you want to save changes to ${currentFileName}?`);
                if (userChoice) {
                    // User wants to save first
                    showSaveDialog();
                    return; // Don't create new file yet
                }
            }

            // Create new file
            resetNotepadState();
            showPopup("âœ¨ NEW FILE CREATED âœ¨<br><br>ğŸ‰ The supreme idiot has created a new file!<br><br>Fresh document ready for your useless thoughts! ğŸ“");
        }

        function showSaveDialog() {
            const content = document.getElementById('notepadText').value;
            if (content.trim() === '') {
                showPopup("ğŸ’¾ SAVE ERROR ğŸ’¾<br><br>Cannot save an empty file, you supreme moron!<br>Write something first, even if it's as stupid as you! ğŸ˜‚");
                return;
            }

            document.getElementById('saveFileName').value = currentFileName === 'Untitled' ? '' : currentFileName;
            document.getElementById('saveDialog').style.display = 'block';
        }

        function closeSaveDialog() {
            document.getElementById('saveDialog').style.display = 'none';
        }

        function saveFile() {
            const fileName = document.getElementById('saveFileName').value.trim();
            const content = document.getElementById('notepadText').value;

            if (!fileName) {
                showPopup("âŒ FILENAME ERROR âŒ<br><br>Enter a filename, you brain-dead moron!<br>Even idiots need to name their files! ğŸ¤¦â€â™‚ï¸");
                return;
            }

            if (content.trim() === '') {
                showPopup("ğŸ’¾ SAVE ERROR ğŸ’¾<br><br>Cannot save an empty file!<br>Write something first, genius! ğŸ˜‚");
                return;
            }

            // Save file to memory storage
            savedFiles[fileName] = {
                content: content,
                dateCreated: new Date().toLocaleString(),
                size: content.length
            };

            // Update file state
            currentFileName = fileName;
            isFileSaved = true;
            lastSavedContent = content;
            updateFileName(fileName);
            closeSaveDialog();

            // Show dramatic save message
            showFakeLoading("Saving file for the supreme idiot...", () => {
                showPopup(`ğŸ’¾ FILE SAVED SUCCESSFULLY! ğŸ’¾<br><br>ğŸ‰ The supreme idiot has saved the file!<br><br>ğŸ“„ File Details:<br>â€¢ Name: ${fileName}<br>â€¢ Size: ${content.length} bytes of pure stupidity<br>â€¢ Author: Supreme Moron (You)<br>â€¢ Date: ${new Date().toLocaleString()}<br>â€¢ Quality: Absolute garbage<br>â€¢ Location: /Documents/IdiotFiles/<br><br>Your useless thoughts have been preserved for eternity! ğŸ—‚ï¸`);
            });
        }

        function showOpenDialog() {
            // Check for unsaved changes first
            if (hasUnsavedChanges()) {
                const userChoice = confirm(`Do you want to save changes to ${currentFileName}?`);
                if (userChoice) {
                    showSaveDialog();
                    return;
                }
            }

            populateFileList();
            document.getElementById('openDialog').style.display = 'block';
        }

        function closeOpenDialog() {
            document.getElementById('openDialog').style.display = 'none';
            document.getElementById('selectedFileName').value = '';
        }

        function populateFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';

            if (Object.keys(savedFiles).length === 0) {
                fileList.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No files found<br>(You haven\'t saved anything yet, genius!)</div>';
                return;
            }

            Object.keys(savedFiles).forEach(fileName => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.textContent = `ğŸ“„ ${fileName} (${savedFiles[fileName].size} bytes)`;
                fileItem.onclick = () => selectFile(fileName, fileItem);
                fileList.appendChild(fileItem);
            });
        }

        function selectFile(fileName, element) {
            // Remove previous selection
            document.querySelectorAll('.file-item').forEach(item => {
                item.classList.remove('selected');
            });

            // Select current item
            element.classList.add('selected');
            document.getElementById('selectedFileName').value = fileName;
        }

        function openSelectedFile() {
            const fileName = document.getElementById('selectedFileName').value;

            if (!fileName) {
                showPopup("ğŸ“‚ SELECTION ERROR ğŸ“‚<br><br>Select a file first, you brainless moron!<br>Even a donkey can click on files! ğŸ´");
                return;
            }

            if (!savedFiles[fileName]) {
                showPopup("ğŸ“‚ FILE ERROR ğŸ“‚<br><br>File not found!<br>Did you delete it with your stupidity? ğŸ¤”");
                return;
            }

            closeOpenDialog();

            // Show dramatic loading
            showFakeLoading("Opening file for this moron...", () => {
                const fileData = savedFiles[fileName];
                document.getElementById('notepadText').value = fileData.content;

                // Update file state
                currentFileName = fileName;
                isFileSaved = true;
                lastSavedContent = fileData.content;
                updateFileName(fileName);

                showPopup(`ğŸ“‚ FILE OPENED SUCCESSFULLY! ğŸ“‚<br><br>ğŸ‰ The moron has opened the file!<br><br>ğŸ“„ File Details:<br>â€¢ Name: ${fileName}<br>â€¢ Size: ${fileData.size} bytes of stupidity<br>â€¢ Created: ${fileData.dateCreated}<br>â€¢ Content Quality: Still garbage<br>â€¢ Status: Successfully loaded for the village idiot<br><br>Welcome back to your collection of useless thoughts! ğŸŠ`);
            });
        }

        // Terminal functions
        function handleTerminalInput(event) {
            if (event.key === 'Enter') {
                const input = document.getElementById('terminalInput');
                const command = input.value.trim().toLowerCase();
                const output = document.getElementById('terminalOutput');

                // Add command to output
                output.innerHTML += `<div>idiot@turmoil:~$ ${input.value}</div>`;

                // Process command
                let response = processCommand(command);
                output.innerHTML += `<div style="color: #ff6666;">${response}</div><br>`;

                // Clear input
                input.value = '';

                // Scroll to bottom
                document.getElementById('terminalContent').scrollTop = document.getElementById('terminalContent').scrollHeight;

                // Check for virus detection command
                if (command.includes('detect virus') || command.includes('virus scan') || command.includes('antivirus')) {
                    setTimeout(showBSOD, 2000);
                }
            }
        }

        function processCommand(command) {
            const responses = {
                'help': 'Available commands: ls, pwd, whoami, date, clear, cat, mkdir, rm, ping, sudo, files\nBut honestly, none of them will help your pathetic existence! ğŸ˜‚',
                'ls': 'disappointment.txt  failure.exe  your_life.trash  README_LOSER.md\nWow, look at all your failures listed so neatly!',
                'pwd': '/home/idiot/desktop_of_shame\nYou are currently lost in your own stupidity!',
                'whoami': 'You are: A certified idiot\nRank: Supreme Moron\nIQ Level: Potato',
                'date': 'Today is: The day you realized you\'re an idiot\nTime: Way past your bedtime\nYear: 2024 (Year of the Dunce)',
                'clear': '\n\n\n\n\n\n\nScreen cleared! But your stupidity remains... ğŸ§¹',
                'cat': 'Meow! Even cats are smarter than you! ğŸ±',
                'mkdir': 'Directory created: /home/idiot/another_failure/\nCongratulations on creating more useless folders!',
                'rm': 'File deleted: your_brain.exe\nOh wait, that file never existed! ğŸ—‘ï¸',
                'ping': 'PING google.com: Destination unreachable\nYour internet is as broken as your logic!',
                'sudo': 'sudo: You are not in the sudoers file. This incident will be reported.\nTo whom? The Department of Idiots?',
                'exit': 'You can\'t exit your own stupidity! Nice try though! ğŸšª',
                'reboot': 'Rebooting your brain... ERROR: No brain found to reboot! ğŸ”„',
                'virus': 'Virus detected: stupidity.exe running at 100% CPU\nRecommendation: Format your brain!',
                'files': `Saved files: ${Object.keys(savedFiles).length > 0 ? Object.keys(savedFiles).join(', ') : 'None (because you\'re useless)'}`,
                'detect virus': 'Scanning for viruses...\n[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%\nCRITICAL VIRUS DETECTED: STUPIDITY.EXE\nSystem compromised! Initiating emergency shutdown...'
            };

            for (let cmd in responses) {
                if (command.includes(cmd)) {
                    return responses[cmd];
                }
            }

            return `Command '${command}' not found. But then again, neither is your brain! ğŸ¤¡\nTry 'help' if you can spell it correctly.`;
        }

        // BSOD functions
        function showBSOD() {
            document.getElementById('bsodScreen').style.display = 'block';
        }

        function hideBSOD() {
            document.getElementById('bsodScreen').style.display = 'none';
        }

        // Recycle Bin
        function showRecycleBinMessage() {
            showPopup("First recycle your rotten brain you useless idiot! ğŸ—‘ï¸ğŸ§ <br><br>Contents of Recycle Bin:<br>â€¢ your_dignity.exe<br>â€¢ common_sense.dll<br>â€¢ intelligence.sys<br>â€¢ self_respect.bak<br><br>All files permanently corrupted beyond recovery!");
        }

        // Fake loading bars and progress indicators
        function showFakeLoading(title, callback) {
            const popup = document.getElementById('messagePopup');
            const content = document.getElementById('popupContent');
            let progress = 0;

            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress > 100) progress = 100;

                content.innerHTML = `
                    <h3>${title}</h3>
                    <div style="background: #ddd; height: 20px; border-radius: 10px; overflow: hidden;">
                        <div style="background: linear-gradient(90deg, #4CAF50, #45a049); height: 100%; width: ${progress}%; transition: width 0.3s;"></div>
                    </div>
                    <p>${progress.toFixed(1)}% Complete</p>
                    <p style="font-size: 12px; color: #666;">${getRandomLoadingMessage()}</p>
                `;

                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        if (callback) callback();
                    }, 1000);
                }
            }, 200);

            popup.style.display = 'block';
        }

        function getRandomLoadingMessage() {
            const messages = [
                "Calibrating stupidity levels...",
                "Downloading more idiocy...",
                "Syncing with Department of Morons...",
                "Optimizing brain damage...",
                "Loading uselessness modules...",
                "Connecting to Idiot Network...",
                "Initializing dumbness protocols...",
                "Buffering stupidity data...",
                "Processing your incompetence...",
                "Installing failure.exe..."
            ];
            return messages[Math.floor(Math.random() * messages.length)];
        }

        // Make windows draggable
        function makeDraggable() {
            const windows = document.querySelectorAll('.window');
            windows.forEach(window => {
                const header = window.querySelector('.window-header');
                let isDragging = false;
                let currentX;
                let currentY;
                let initialX;
                let initialY;
                let xOffset = 0;
                let yOffset = 0;

                header.addEventListener('mousedown', dragStart);
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', dragEnd);

                function dragStart(e) {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;

                    if (e.target === header || header.contains(e.target)) {
                        isDragging = true;
                    }
                }

                function drag(e) {
                    if (isDragging) {
                        e.preventDefault();
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;

                        xOffset = currentX;
                        yOffset = currentY;

                        window.style.transform = `translate3d(${currentX}px, ${currentY}px, 0)`;
                    }
                }

                function dragEnd() {
                    initialX = currentX;
                    initialY = currentY;
                    isDragging = false;
                }
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            makeDraggable();
            updateSystemInfo();
            resetNotepadState();

            // Track changes in notepad
            document.getElementById('notepadText').addEventListener('input', function () {
                // This will automatically track unsaved changes
            });

            // Close dialogs when clicking outside
            document.addEventListener('click', function (event) {
                const startMenu = document.getElementById('startMenu');
                const startButton = document.querySelector('.start-button');
                const saveDialog = document.getElementById('saveDialog');
                const openDialog = document.getElementById('openDialog');

                if (!startMenu.contains(event.target) && !startButton.contains(event.target)) {
                    startMenu.style.display = 'none';
                }

                if (!saveDialog.contains(event.target) && saveDialog.style.display === 'block') {
                    if (!event.target.closest('button[onclick="showSaveDialog()"]')) {
                        // Don't close if clicking the save button
                    }
                }

                if (!openDialog.contains(event.target) && openDialog.style.display === 'block') {
                    if (!event.target.closest('button[onclick="showOpenDialog()"]')) {
                        // Don't close if clicking the open button  
                    }
                }
            });

            // Auto-focus terminal input when terminal opens
            const terminalObserver = new MutationObserver(function (mutations) {
                mutations.forEach(function (mutation) {
                    if (mutation.target.id === 'terminalWindow' && mutation.target.style.display === 'block') {
                        setTimeout(() => {
                            document.getElementById('terminalInput').focus();
                        }, 100);
                    }
                });
            });

            const terminalWindow = document.getElementById('terminalWindow');
            terminalObserver.observe(terminalWindow, { attributes: true, attributeFilter: ['style'] });

            // Random system notifications
            setInterval(() => {
                const notifications = [
                    "System Alert: Your stupidity levels are critically high!",
                    "Warning: Brain.exe has stopped responding",
                    "Update Available: Intelligence 2.0 (Not compatible with your system)",
                    "Security Alert: Common sense firewall disabled",
                    "Performance Warning: IQ running at 1% capacity"
                ];

                if (Math.random() < 0.05) { // 5% chance
                    setTimeout(() => {
                        showPopup("ğŸš¨ SYSTEM NOTIFICATION ğŸš¨<br><br>" + notifications[Math.floor(Math.random() * notifications.length)]);
                    }, Math.random() * 3000);
                }
            }, 10000);

            // Add some glitch effects
            setInterval(() => {
                if (Math.random() < 0.02) { // 2% chance
                    document.body.style.filter = 'hue-rotate(' + Math.random() * 360 + 'deg) saturate(' + (Math.random() * 3) + ')';
                    setTimeout(() => {
                        document.body.style.filter = 'none';
                    }, 200);
                }
            }, 1000);

            // Easter egg: Konami code
            let konamiCode = [];
            const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'KeyB', 'KeyA'];

            document.addEventListener('keydown', function (event) {
                konamiCode.push(event.code);
                if (konamiCode.length > konamiSequence.length) {
                    konamiCode.shift();
                }

                if (konamiCode.length === konamiSequence.length && konamiCode.every((code, index) => code === konamiSequence[index])) {
                    showPopup("ğŸ‰ CONGRATULATIONS! ğŸ‰<br><br>You found the secret code!<br>Unfortunately, you're still an idiot.<br><br>Achievement Unlocked:<br>'Master of Uselessness' ğŸ†<br><br>Reward: Absolutely nothing! ğŸ˜‚");
                    konamiCode = [];
                }
            });
        });
    </script>
</body>

</html>